<div class="vertical-spacer-5"></div>

<!-- <div class="row">
  <% @request.request_images.each do |request_image| %>
    <div class="col s6 m4 l3">
      <%= image_tag request_image.image_url rescue nil %>
    </div>
  <% end %>
</div> -->

<div class="row">
  <div class="col s12">
    <div class="card">
      <div class="card-content">
        <h5 class="card-stats-number center" style="word-spacing:500px">
          Details 
          <%= link_to 'Chat',
          chat_path(Conversation.where(receiver_id:@request,conversationable_type: "User").first.id), 
          :onclick=>"window.open(this.href,'chat', 'height=500, width=500');return false;" rescue nil
          %> 
      </h5>

        
        <p class="card-stats-title">Name:
          <b><%= @request.name %></b>
        </p>
        <p class="card-stats-title">Category:
          <b><%= @request.sub_category.name %></b>
        </p>
        <p class="card-stats-title">Sent on:
          <b><%= @request.created_at.strftime('%d %b %Y') %></b>
        </p>
        <p class="card-stats-title">Username:
          <b><%= link_to @request.user.username, support_user_path(@request.user) %></b>
        </p>
        <p class="card-stats-title">Size:
          <b><%= @request.size.upcase %></b>
        </p>
        <p class="card-stats-title">Shipping address:
          <b><%= @request.address.formatted_address %></b>
        </p>
        <p class="card-stats-title">Budget:
          <b><%= @request.max_budget&.round %></b>
        </p>
        <p class="card-stats-title">Offers Count:
          <b><%= @request.offers.size %></b>
        </p>
        <p class="card-stats-title">Designers:
          <b><%= RequestDesigner.joins(designer: :designer_store_info).where(request: @request).pluck(:display_name).to_sentence %></b>
        </p>
        <b>Request Image:</b>
        <p class="card-stats-title">
          <% @request.request_images.each do |req_image| %>
            <a data-fancybox="gallery" href="<%= req_image.image_url %>"><img src="<%= req_image.image_url %>" id="thumb"></a>
          <% end %>
        </p>
      </div>
    </div>
  </div>
</div>



<% if (@request.offers.size > 0) %>

  <div class="row">
    <h5 class="center">Offers</h5>
    <table class="highlight">
      <thead>        
        <tr>
          
          <th colspan="4" class="center">Designer Name</th>
          <th colspan="1" class="center">Quotes</th>
      </thead>
      <tbody>
        <tr>
          <% @request.offers.each do |off| %>
            <% Designer.where(id:off.designer_id).each do |des_name| %>
              <td colspan="4" class="center"><%= des_name.full_name  %></td>
              <td colspan="1" class="center" id="offer_quote"><%=  OfferQuotation.where(offer_id:off).count %></td>
            <% end %>
          <% end %>
        </tr>
      </tbody>
    </table>
  </div>

<% else %>
  <h5>No offers yet</h5>
<% end %>



<div class="col s12 m6 l6", id="collapse_offer">
  <ul class="collapsible" data-collapsible="expandable">
    <li>
      <% @request.offers.each do |off| %>
        <% OfferQuotation.where(offer_id:off).each do |offquo| %> 
          <div class="collapsible-header active">
            
            <a href="#">Quote Details</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <%= link_to 'User Chat',
            chat_path(Conversation.where(receiver_id:offquo,conversationable_type: "User").first.id), 
            :onclick=>"window.open(this.href,'chat', 'height=500, width=500');return false;", id:"chatbutton" rescue nil
            %>
            <%= link_to 'Designer Chat',
            chat_path(Conversation.where(receiver_id:offquo,conversationable_type: "Designer").first.id), 
            :onclick=>"window.open(this.href,'chat', 'height=500, width=500');return false;", id:"chatbutton" rescue nil
            %>
          </div>

          <div class="collapsible-body">
            <ul class="collection">             
              <li class="collection-item">Price: <b><%= offquo.price %></b></li>
              <li class="collection-item">Description: <b><%= offquo.description %></b></li>
              <li class="collection-item">Designer Note: <b><%= offquo.designer_note %></b></li> 
              <% OfferMeasurement.where(offer_quotation_id:offquo).each do |offmeas| %>
                <li class="collection-item">Offer Measurement: <b><%= offmeas.data.map{|k,v| "#{k}=#{v}"}.join('&').strip %></b></li>
              <% end %>
              <% OfferQuotationGallery.where(offer_quotation_id:offquo).each do |offgall| %>
                <p class="card-stats-title">
                  <% Image.where(imageable_id:offgall).each do |gallery_image| %>            
                      <a data-fancybox="gallery" href="<%= gallery_image.image_url %>"><img src="<%= gallery_image.image_url %>" id="thumb"></a>
                  <% end %>
                </p>
              <% end %>
            </ul>
          </div>
        <% end %>
      <% end %>      
    </li>
  </ul>
</div>
  
<!-- <script type="text/javascript">
  
  $("#offer_quote").click(function(){
    $("#collapse_offer").fadeToggle();
});
</script> -->

<style type="text/css">
  #thumb
  {
    margin-right: 25px;
  }
  .collapsible-header > a > #chatbutton
  {
    text-align: right;
  }
</style>
