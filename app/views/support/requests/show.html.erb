<div class="vertical-spacer-5"></div>

<!-- <div class="row">
  <% @request.request_images.each do |request_image| %>
    <div class="col s6 m4 l3">
      <%= image_tag request_image.image_url rescue nil %>
    </div>
  <% end %>
</div> -->

<div class="row">
  <div class="col s12">
    <div class="card">
      <div class="card-content">
        <h5 class="card-stats-number center">Details</h5>
        <p class="card-stats-title">Name:
          <b><%= @request.name %></b>
        </p>
        <p class="card-stats-title">Category:
          <b><%= @request.sub_category.name %></b>
        </p>
        <p class="card-stats-title">Sent on:
          <b><%= @request.created_at.strftime('%d %b %Y') %></b>
        </p>
        <p class="card-stats-title">Username:
          <b><%= link_to @request.user.username, support_user_path(@request.user) %></b>
        </p>
        <p class="card-stats-title">Size:
          <b><%= @request.size.upcase %></b>
        </p>
        <p class="card-stats-title">Shipping address:
          <b><%= @request.address.formatted_address %></b>
        </p>
        <p class="card-stats-title">Budget:
          <b><%= @request.max_budget&.round %></b>
        </p>
        <p class="card-stats-title">Offers Count:
          <b><%= @request.offers.size %></b>
        </p>
        <p class="card-stats-title">Designers:
          <b><%= RequestDesigner.joins(designer: :designer_store_info).where(request: @request).pluck(:display_name).to_sentence %></b>
        </p>
      </div>
    </div>
  </div>
</div>


<% if (@request.offers.size > 0) %>

  <!-- Offers List -->
  <div class="row">
    <h5 class="center">Offers</h5>
    <% @request.offers.each do |off| %>
    <table class="highlight">
      <thead>
        <% if ((OfferQuotation.where(offer_id:off).count) || (OfferMeasurement.where(offer_quotation_id:offquo).count) || (OfferQuotationGallery.where(offer_quotation_id:offquo).count))  == 1 %>
          <tr>
            <th colspan="1" class="center">Price</th>
            <th colspan="1" class="center">Description</th>
            <th colspan="1" class="center">Designer Note</th>
            <th colspan="1" class="center">Measurements</th>
            <th colspan="1" class="center">Gallery Name</th>
          </tr>
        <% elsif ((OfferQuotation.where(offer_id:off).count) || (OfferMeasurement.where(offer_quotation_id:offquo).count) || (OfferQuotationGallery.where(offer_quotation_id:offquo).count))  == 2 %>
          <tr>
            <th colspan="1" class="center">Price</th>
            <th colspan="1" class="center">Description</th>
            <th colspan="1" class="center">Designer Note</th>
            <th colspan="1" class="center">Measurements</th>
            <th colspan="1" class="center">Gallery Name</th>
            <div class="row">
              <th colspan="1" class="center">Quote 2 Price</th>
              <th colspan="1" class="center">Quote 2 Description</th>
              <th colspan="1" class="center">Quote 2 Designer Note</th>
              <th colspan="1" class="center">Quote 2 Measurements</th>
              <th colspan="1" class="center">Quote 2 Gallery Name</th>
            </div>
          </tr>
        <% else %>
          <tr>
            <th colspan="1" class="center">Price</th>
            <th colspan="1" class="center">Description</th>
            <th colspan="1" class="center">Designer Note</th>
            <th colspan="1" class="center">Measurements</th>
            <th colspan="1" class="center">Gallery Name</th>
            <div class="row">
              <th colspan="1" class="center">Quote 2 Price</th>
              <th colspan="1" class="center">Quote 2 Description</th>
              <th colspan="1" class="center">Quote 2 Designer Note</th>
              <th colspan="1" class="center">Quote 2 Measurements</th>
              <th colspan="1" class="center">Quote 2 Gallery Name</th>
            </div>
            <div class="row">
              <th colspan="1" class="center">Quote 3 Price</th>
              <th colspan="1" class="center">Quote 3 Description</th>
              <th colspan="1" class="center">Quote 3 Designer Note</th>
              <th colspan="1" class="center">Quote 3 Measurements</th>
              <th colspan="1" class="center">Quote 3 Gallery Name</th>
            </div>
          </tr>
        <% end %>
      </thead>
      <tbody>
        <tr>
          <td colspan="1" class="center"></td>
        </tr>
      </tbody>
    </table>
  </div>

<% else %>
  <h5>No offers yet</h5>
<% end %>

<div class="row">
  <% @request.request_images.each do |request_image| %>
    <div class="col s6 m4 l3">
      <a data-fancybox="gallery" href="<%= request_image.image_url %>"><img src="<%= request_image.image_url %>" id="thumb"></a>
    </div>
  <% end %>
</div>
